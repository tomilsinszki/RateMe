{% extends '::base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}

    <link href="{{ asset('css/select.css') }}" type="text/css" rel="stylesheet"/>
    <link href="{{ asset('css/chosen.css') }}" type="text/css" rel="stylesheet" />
    <style type="text/css">
        .content .gray {
            color: gray;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="{{ asset('bundles/acmerating/js/rateableCollectionEdit.js') }}" type="text/javascript"></script>
    <script src="{{ asset('js/chosen.jquery.min.js') }}" type="text/javascript"></script>

    <script type="text/javascript">
        $(function () {
            $('#rateableCollectionSelect').on('change', function () {
                window.location = '{{ path('rateable_collection_profile_edit_by_id', {'id': 0}) }}'.replace('0', $(this).val());
            }).chosen({
                disable_search: true,
                width: "300px"
            });
        });
    </script>
{% endblock %}

{% block body %}
    {{ parent() }}

    {% include "AcmeSubRatingBundle:Partials:ownedCollectionsSelect.html.twig" with {'collection': rateableCollection} %}

    <table border="0">
        <tr>
            <td style="padding-right:30px;">
                {% if collectionImageURL %}
                    <img src="{{ asset(collectionImageURL) }}"/>
                {% endif %}

                <form action="{{ path('rateable_collection_upload_image', {'id': rateableCollection.id}) }}"
                      method="post" {{ form_enctype(imageUploadForm) }}>
                    {{ form_widget(imageUploadForm) }}

                    <input type="submit" value="Kép beállítása"/>
                </form>
            </td>

            <td style="vertical-align: top;">
                <form id="rateableCollectionEditForm" method="post">
                    {% if not newRateableForm.vars.valid %}
                        <div style="margin-top:5px;">
                            {{ form_errors(editForm) }}
                        </div>
                    {% endif %}

                    <div style="margin-top:5px;">
                        {{ form_widget(editForm.name, {'attr': {'placeholder': 'Üzlet neve'} }) }}
                    </div>

                    <div style="margin-top:5px;">
                        {{ form_widget(editForm.foreignUrl, {'attr': {'placeholder': 'Honlap URL'} }) }}
                    </div>

                    <div style="margin-top:5px;">
                        {{ form_widget(editForm.identifier, {'attr': {'placeholder': 'Azonosító'} }) }}
                    </div>

                    {{ form_rest(editForm) }}
                    <div style="margin-top:5px;">
                        <input type="submit" value="mentés"/>
                    </div>
                </form>
            </td>
        </tr>
    </table>

    <form id="newRateableForm" style="border-top:1px solid black; padding-top:10px;" method="post">
        <input name="rateableCollectionId" value="{{ rateableCollection.id }}" type="hidden"/>

        {% if not newRateableForm.vars.valid %}
            <div style="margin-top:5px;">
                {{ form_errors(newRateableForm) }}
            </div>
        {% endif %}

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.rateableName, {'attr': {'placeholder': 'Dolgozó neve'} }) }}
        </div>

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.rateableTypeName, {'attr': {'placeholder': 'Beosztás'} }) }}
        </div>

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.username, {'attr': {'placeholder': 'Felhasználónév'} }) }}
        </div>

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.password.first, {'attr': {'placeholder': 'Jelszó'} }) }}
        </div>

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.password.second, {'attr': {'placeholder': 'Jelszó megint'} }) }}
        </div>

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.viaPhone) }}
            {{ form_label(newRateableForm.viaPhone) }}
        </div>

        <div style="margin-top:5px;">
            {{ form_widget(newRateableForm.identifier, {'attr': {'placeholder': 'Azonosító'} }) }}
        </div>

        {{ form_rest(newRateableForm) }}

        <div style="margin-top:5px;">
            <input type="submit" value="létrehozás"/>
        </div>
    </form>

    <h1>Aktív dolgozók</h1>
    <div id="active-rateables">
        {% for rateable in rateables %}
            <div style="border-top:1px solid black; padding-top:10px;">
                <div style="margin-top:5px;">
                    {{ rateable.name }}
                </div>

                <div style="margin-top:5px;">
                    {{ rateable.typeName }}
                </div>

                <div style="margin-top:5px;">
                    <a style="display: inline;" class="profile-link{{ rateable.rateableUser.isActive ? '' : ' gray' }}"
                       href="{{ rateable.rateableUser.isActive ? path('rateable_profile_by_id', {'id': rateable.id}) : '#' }}"
                       data-href="{{ path('rateable_profile_by_id', {'id': rateable.id}) }}">Profil</a>
                </div>

                <div style="margin-top:5px;">
                    <input
                            name="rateableIsArchive"
                            id="rateableIsArchive_{{ rateable.id }}"
                            class="rateableIsArchive"
                            type="checkbox"
                            value="Archív"
                            {{ rateable.rateableUser.isActive ? '' : ' checked="checked"' }}
                            data-url="{{ path('rateable_archive', {rateable: rateable.id}) }}"
                            />
                    <label for="rateableIsArchive_{{ rateable.id }}">Archív</label>
                </div>
            </div>
        {% endfor %}
    </div>
    <h1 class="gray">Inaktív dolgozók</h1>
    <div id="inactive-rateables"></div>
{% endblock %}
